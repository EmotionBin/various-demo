# 图片自动矫正旋转

有时候上传图片的时候会造成图片自动旋转，需要前端攻城狮去把它矫正，造成这种现象的根本原因就是图片的 EXIF 信息中的 Orientation 字段值错误  

**注意：要读取图片的 EXIF 数据，那么图片必须要满足 EXIF 标准，目前 EXIF 标准仅适用于 .jpg 和 .tiff 图像**  

要自动矫正错误旋转的图片，必须要拿到该图片的 Orientation 字段值，Orientation 字段值可能为以下几种：  

| 旋转角度        | 参数     |
| :--------:     | :-----:  |
| 0°             |   1      |  
| 顺时针90°       |   6     |   
| 逆时针90°       |   8     |  
| 180°           |    3     |  

**注意：图片如果经过编辑器编辑过，并且保存之后，图片的 Orientation 字段值很可能就变成了 1，因为人为的保存图片后，默认这张图片是正常显示的，没有出现旋转的情况**

这里可以在线查看 EXIF 信息 [传送门](http://exif-viewer.com)  

要进行自动矫正，这里就需要借助一个第三方库，`exif-js`，github地址 [传送门](https://github.com/exif-js/exif-js)  

这里可以查看各种 API 的使用 [传送门](http://code.ciaoca.com/javascript/exif-js)  

具体实现可以看 index.js 文件，images 目录下有一些可用的图片(满足 EXIF 标准，并且存储有 EXIF 数据)可以测试，那个键盘的图片(test4.jpg)用不了，因为没有 EXIF 数据  

## 一些其他的东西

**图片旋转后保存状态**

如果现在有个需求，假设页面中有一些图片，要求用户可以旋转图片并保存图片旋转后的状态，这时候就可以借助 canvas 来完成了，具体实现原理就是，在用户旋转图片完成后，在内存中创建一个 canvas，再利用 canvas 的 drawImage() 方法复制一份旋转后的图片(这时候的图片可能是 base64 格式或者是 blob格式，需要手动转成图片 file 格式)，这样就成功获取到用户手动旋转后的图片了，再把这张图片上传到服务端更新图片，这个功能就实现了  

**写入图片的 EXIF 信息**

写入图片的 EXIF 信息也需要借助一个第三方的库 [传送门](https://github.com/hMatoba/piexifjs)，这里先给一个链接吧，最近比较忙没什么时间研究~这里有篇文章写得还不错 [传送门](https://jiangck.com/articles/2020/07/22/1595397717121.html)  
