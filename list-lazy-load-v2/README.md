# 大数据懒加载2.0

相比于1.0版本做了更多的优化工作，优化内容如下

1. 滚动条可以自动适应各种高度变化，不会像 1.0 版本中，滚动条触底会强制回到顶部  
2. 体验会比 1.0 版本流畅一些  

## 实现的核心原理

思路主要就是虚拟化，动态的追加 `padding-top` 和 `padding-bottom` 让滚动条自适应。其实我们看到的就只有那么一部分的数据(具体数值可以自己设置)，这些数据存放在一个容器中，当可视区域的最后一条数据是容器中的最后一条数据时，把可视区域内看不到的数据项删除，再加入新的数据(这个删除的数据量和加入的数据量必然是相等的，这样才能保证容器大小长度不变，否则可能会造成滚动条的波动、闪烁等bug)，假设删除的数据 `dom` 长度是 `500px`，则在删除数据的同时在父元素追加 `500px` 的 `padding-top`，同时减少 `500px` 的 `padding-bottom`  

**简单来说，向下滚动，要加载数据的时候，就增加 `padding-top` 减少 `padding-bottom`，向上滚动，要加载数据的时候，就减少 `padding-top` 增加 `padding-bottom`**  

## 存在的不足

1. 当数据量过大，鼠标拉动滚动条的速度过快时，会产生bug(我本地测试超过三万条数据才会出现此bug，还要根据具体运行环境确定)
2. 鼠标滚动滚动条，在加载新节点的时会有轻微卡顿现象  
3. 当点击全选后，鼠标快速拉动滚动条，新节点并不能马上全选，会有一个闪烁的过程，但是持续时间微乎及微

## 对于不足的解决方案

对于第1点、第2点暂无解决思路，针对上述第3点给出解决思路，但是在这个 `demo` 中并未实现，思路如下:  

方案1: 在调用全选函数( `setCheckedKeys` )前，先给对应的 `dom` 元素设置 `visibility = 'hidden'`(让它隐藏)，调用函数结束后再设置 `visibility = 'visible'`(让它显示)，注意，这个全选函数是异步执行的，所以我们也要异步设置 `visibility = 'visible'`，同步设置无效，异步方案可采用 `setTimeout` 等  

方案2: 首先放置一个和视窗大小相同宽高的 `div`，位置也要和视窗元素重合，初始化的时候设置隐藏，在调用全选函数( `setCheckedKeys` )前，让这个 `div` 显示并完全遮挡在视窗上，其中可以加入一些提示信息，如**加载中...**或者**转圈圈的等待图标**，在函数调用结束后，再让这个 `div` 隐藏(注意异步)  

总结一下，**解决办法就是先让新节点不显示，等到它变为勾选状态后再显示即可**  

