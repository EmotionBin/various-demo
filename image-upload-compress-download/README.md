# 图片的各种功能

这里将演示图片的**下载**、**上传**、**压缩**  

这里有两个文件夹，server 用于作为 node 服务端，主要是用于模拟跨域，client 其实也是个 node 服务，但是也用于展示前端网页，可以看做客户端  

## 图片下载

**操作方法**

首先打开命令行，进入 server 和 client 这两个文件夹的根目录下，执行 `node app.js` 命令，开启服务，端口分别是 9527 和 9528，在浏览器中输入 `http://localhost:9528/image-download.html`  

这里演示了四种下载图片的方式，其实这四种方式不一定是下载图片，也可以用于下载文件等  

- a 标签下载

如果使用 a 标签下载，需要使用 a 标签的 download 属性，而且只能是同源的情况下，因为 download 属性在跨域情况下会失效，不会下载图片，只会打开

- base64 下载

需要将图片转换成 base64 格式后再进行下载，这里需要用到 canvas 的一些方法，如果在跨域的情况下需要把图片的属性 `crossOrigin` 设置为 `Anonymous`，并且需要后端设置跨域资源共享(CORS)。这种方式的优势是，支持跨域(前提是前端和后端都要做相应的处理)，缺点是使用 base64 会造成图片体积变大的情况，对于 gif 格式的图片只能下载第一帧的图片  

- blob 下载

需要将图片转换成 blob 格式后再进行下载，这里需要用到 canvas 的一些方法，如果在跨域的情况下需要把图片的属性 `crossOrigin` 设置为 `Anonymous`，并且需要后端设置跨域资源共享(CORS)。这种方式的优势是，支持跨域(前提是前端和后端都要做相应的处理)，缺点是使用 blob 会造成图片体积变大的情况，对于 gif 格式的图片只能下载第一帧的图片  

- http 请求下载

先发送一个 http 请求，请求图片地址，拿到返回内容后，将返回内容转换成 blob 格式，再进行下载操作，在跨域的情况下前端可以不用处理，需要后端设置跨域资源共享(CORS)即可，对于gif格式的图片也能完整保存  

## 图片压缩

首先分别开启服务端和客服端服务，方法同上，在浏览器中输入 `http://localhost:9528/image-compress.html`    

图片压缩的核心原理其实很简单，就是调用 canvas 的 drawImage() 方法实现的，canvas 本质上就是一张位图，而 drawImage() 方法可以把一张大大的图片绘制在小小的 canvas 画布上，等同于图片尺寸压缩了  

再调用了 canvas 的 drawImage() 方法后，如果想把压缩后的图片呈现出来，可以使用 base64 或者 blob  


